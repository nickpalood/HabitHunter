<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Graphs & Stats - Simple Budget Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='graphs.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <div class="navbar-brand">
            <div class="navbar-avatar">A</div>
            <strong>Budget Tracker</strong>
        </div>
        <div class="navbar-nav">
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
            <a href="{{ url_for('income') }}">Income</a>
            <a href="{{ url_for('expenses') }}">Expenses</a>
            <a href="{{ url_for('budgets') }}">Budgets</a>
            <a href="{{ url_for('graphs_stats') }}" class="active">Graphs & Stats</a>
            <a href="{{ url_for('reports') }}">Reports</a>
        </div>
    </div>

    <div class="container container-lg">
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="flash-messages">
            {% for message in messages %}
              <div class="alert alert-success">{{ message }}</div>
            {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <!-- Page Header -->
        <div class="page-header">
            <div>
                <h1>üìä Analytics & Insights</h1>
                <p>Deep dive into your spending patterns and financial trends</p>
            </div>
        </div>

        <!-- Quick Stats Section -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üí∞</div>
                <div class="stat-content">
                    <div class="stat-label">Total Income</div>
                    <div class="stat-value">‚Ç¨{{ "%.2f"|format(total_income) }}</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">üí∏</div>
                <div class="stat-content">
                    <div class="stat-label">Total Expenses</div>
                    <div class="stat-value">‚Ç¨{{ "%.2f"|format(total_expenses) }}</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">üìà</div>
                <div class="stat-content">
                    <div class="stat-label">Balance</div>
                    <div class="stat-value" style="color: {% if balance >= 0 %}#10b981{% else %}#ef4444{% endif %};">‚Ç¨{{ "%.2f"|format(balance) }}</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">üìä</div>
                <div class="stat-content">
                    <div class="stat-label">Avg Transaction</div>
                    <div class="stat-value">‚Ç¨{{ "%.2f"|format(avg_expense) }}</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">üéØ</div>
                <div class="stat-content">
                    <div class="stat-label">Max Expense</div>
                    <div class="stat-value">‚Ç¨{{ "%.2f"|format(max_expense) }}</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">‚è±Ô∏è</div>
                <div class="stat-content">
                    <div class="stat-label">Busiest Day</div>
                    <div class="stat-value" style="font-size: 1rem;">{{ busiest_day }}</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%);">üåô</div>
                <div class="stat-content">
                    <div class="stat-label">Avg Daily Spend</div>
                    <div class="stat-value">‚Ç¨{{ "%.2f"|format(avg_daily_spend) }}</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #1fa2ff 0%, #12d8fa 100%);">üíé</div>
                <div class="stat-content">
                    <div class="stat-label">Min Expense</div>
                    <div class="stat-value">‚Ç¨{{ "%.2f"|format(min_expense) }}</div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            
            <!-- 1. Spending by Category (Bar Chart) -->
            {% if category_labels %}
            <div class="card chart-card">
                <div class="card-header">
                    <h3>üíπ Spending by Category</h3>
                    <p class="chart-subtitle">Total breakdown of your expenses</p>
                </div>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
            {% endif %}

            <!-- 2. Top Categories Pie -->
            {% if top_cat_names %}
            <div class="card chart-card">
                <div class="card-header">
                    <h3>ü•á Top 5 Categories</h3>
                    <p class="chart-subtitle">Your biggest spending areas</p>
                </div>
                <div class="chart-container">
                    <canvas id="topCategoriesChart"></canvas>
                </div>
            </div>
            {% endif %}

            <!-- 3. Spending by Day of Week -->
            {% if day_labels %}
            <div class="card chart-card">
                <div class="card-header">
                    <h3>üìÖ Spending by Day of Week</h3>
                    <p class="chart-subtitle">Which days do you spend the most?</p>
                </div>
                <div class="chart-container">
                    <canvas id="dayChart"></canvas>
                </div>
            </div>
            {% endif %}

            <!-- 4. Transaction Frequency by Day -->
            {% if day_transaction_counts %}
            <div class="card chart-card">
                <div class="card-header">
                    <h3>üîî Transaction Frequency</h3>
                    <p class="chart-subtitle">How many transactions per day?</p>
                </div>
                <div class="chart-container">
                    <canvas id="frequencyChart"></canvas>
                </div>
            </div>
            {% endif %}

            <!-- 5. Monthly Trend (Income vs Expenses) -->
            {% if month_labels %}
            <div class="card chart-card full-width">
                <div class="card-header">
                    <h3>üìà Monthly Trends</h3>
                    <p class="chart-subtitle">Income and expense trends over time</p>
                </div>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
            {% endif %}

            <!-- 6. Spending Throughout the Month -->
            {% if date_labels %}
            <div class="card chart-card full-width">
                <div class="card-header">
                    <h3>üìä Cumulative Monthly Spending</h3>
                    <p class="chart-subtitle">How your spending distributes across the month</p>
                </div>
                <div class="chart-container">
                    <canvas id="dateChart"></canvas>
                </div>
            </div>
            {% endif %}

            <!-- 7. Category Breakdown Table -->
            {% if expense_percentages %}
            <div class="card chart-card full-width">
                <div class="card-header">
                    <h3>üéØ Category Breakdown</h3>
                    <p class="chart-subtitle">Percentage of total spending per category</p>
                </div>
                <div class="category-table">
                    {% for category, percentage in expense_percentages.items() | sort %}
                    <div class="category-row">
                        <div class="category-name">{{ category }}</div>
                        <div class="category-bar">
                            <div class="category-fill" style="width: {{ percentage }}%; background: linear-gradient(90deg, #a855f7 0%, #ec4899 100%);"></div>
                        </div>
                        <div class="category-percent">{{ "%.1f"|format(percentage) }}%</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

    </div>

    <script>
        const colors = [
            '#a855f7', '#ef4444', '#f59e0b', '#10b981', '#3b82f6',
            '#ec4899', '#06b6d4', '#8b5cf6', '#f97316', '#14b8a6'
        ];

        // 1. Spending by Category (Bar Chart)
        const categoryCtx = document.getElementById('categoryChart');
        if (categoryCtx) {
            new Chart(categoryCtx, {
                type: 'bar',
                data: {
                    labels: {{ category_labels|tojson }},
                    datasets: [{
                        label: 'Total Spending (‚Ç¨)',
                        data: {{ category_values|tojson }},
                        backgroundColor: colors,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // 2. Top Categories (Pie Chart)
        const topCatCtx = document.getElementById('topCategoriesChart');
        if (topCatCtx) {
            new Chart(topCatCtx, {
                type: 'doughnut',
                data: {
                    labels: {{ top_cat_names|tojson }},
                    datasets: [{
                        data: {{ top_cat_values|tojson }},
                        backgroundColor: colors.slice(0, {{ top_cat_names|length }}),
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }

        // 3. Day of Week (Area Chart)
        const dayCtx = document.getElementById('dayChart');
        if (dayCtx) {
            new Chart(dayCtx, {
                type: 'line',
                data: {
                    labels: {{ day_labels|tojson }},
                    datasets: [{
                        label: 'Spending (‚Ç¨)',
                        data: {{ day_values|tojson }},
                        borderColor: '#a855f7',
                        backgroundColor: 'rgba(168, 85, 247, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointBackgroundColor: '#a855f7',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // 4. Transaction Frequency (Bar Chart)
        const freqCtx = document.getElementById('frequencyChart');
        if (freqCtx) {
            new Chart(freqCtx, {
                type: 'bar',
                data: {
                    labels: {{ day_labels|tojson }},
                    datasets: [{
                        label: 'Number of Transactions',
                        data: {{ day_transaction_counts|tojson }},
                        backgroundColor: [
                            'rgba(168, 85, 247, 0.8)',
                            'rgba(168, 85, 247, 0.7)',
                            'rgba(168, 85, 247, 0.6)',
                            'rgba(168, 85, 247, 0.8)',
                            'rgba(168, 85, 247, 0.7)',
                            'rgba(168, 85, 247, 0.5)',
                            'rgba(168, 85, 247, 0.4)'
                        ],
                        borderColor: '#a855f7',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // 5. Monthly Trend (Line Chart)
        const trendCtx = document.getElementById('trendChart');
        if (trendCtx) {
            new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: {{ month_labels|tojson }},
                    datasets: [
                        {
                            label: 'Income',
                            data: {{ income_trend|tojson }},
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'Expenses',
                            data: {{ expense_trend|tojson }},
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#ef4444',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: { size: 12 }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // 6. Spending Throughout Month (Area Chart)
        const dateCtx = document.getElementById('dateChart');
        if (dateCtx) {
            new Chart(dateCtx, {
                type: 'line',
                data: {
                    labels: {{ date_labels|tojson }},
                    datasets: [{
                        label: 'Daily Spending (‚Ç¨)',
                        data: {{ date_values|tojson }},
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.15)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#f59e0b',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
